<!DOCTYPE html>
<html>
<% include ../header.ejs %>
<body class="orderList">
<header>
    <div class="bd-index-header">
        <div class="bd-index-header-icon-back" id="reset_btn_back">
            <span></span>
        </div>
        <div class="bd-index-header-title">
            <%= title %>
        </div>
    </div>
</header>
<div class="order-tab bdb-1px">
    <ul>
        <li class="li_orderlist" func-id="newUserAllOrderList">
            <a href="javascript:;"><span>全部</span></a>
        </li>
        <li class="li_orderlist curr" func-id="wait4Payment">
            <a href="javascript:;"><span>待付款</span></a>
        </li>
        <li class="li_orderlist" func-id="wait4Delivery">
            <a href="javascript:;"><span>待收货</span></a>
        </li>
        <li class="li_orderlist" func-id="userCompletedOrderList">
            <a href="javascript:;"><span>已完成</span></a>
        </li>
        <li class="li_orderlist" func-id="otherOrderList">
            <a href="javascript:;"><span>其他订单</span></a>
        </li>
    </ul>
</div>
<div id="div_orderlist">
    <div id="allOrders" style="position: relative;display: block">

    </div>
    <div class="no-order" id="noOrder" style="display: none;">
        <div class="noorder-pic">

        </div>
        <span>您还没有相关订单</span>
    </div>
</div>

<script type="text/html" id="tpl_orderList">
    <~ if(orderlist && orderlist.length>0 ) { ~>

    <~ orderlist.forEach(function(item){ ~>

    <div class="weui-panel  nopadding weui-panel_access">
        <div class="weui-panel__hd weui-flex">
            <div class="weui-flex__item" style="color: #000;">
                   <span style="overflow: hidden;
                   display: block;
                   white-space: nowrap;
                   text-overflow: ellipsis;
                   max-width: 156px;">
                   <i class="fa fa-lemon-o" style="color:#f56c6c">
                      <span style="color:#000;margin-left: 5px ">布丁酒店</span>
                   </i>
                   </span>
            </div>
            <div class="weui-flex__item" style="color:#f15353;text-align:right">
                <~= item.state_display ~>
            </div>
        </div>

        <div class="weui-panel__bd">
            <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">

                <~ if(item.items.length<=1){ ~>

                <div class="weui-media-box__hd">
                    <img class="weui-media-box__thumb"
                         src="<~= item.items[0].product.image ~>">
                </div>
                <div class="weui-media-box__bd">
                    <p class="weui-media-box__desc">
                        <~= item.items[0].product.name+" "+item.items[0].product.brief  ~>
                    </p>
                </div>

                <~ } else { ~>

                <~ item.items.forEach(function(o){ ~>

                <div class="weui-media-box__hd">
                    <img class="weui-media-box__thumb"
                         src="<~= o.product.image ~>">
                </div>

                <~ }) ~>

                <~ } ~>
            </a>
        </div>
        <div class="weui-panel__ft">
            <div href="javascript:void(0);" class="weui-cell weui-cell_link">
                <div class="weui-cell__bd" style="color: #000">实付款:¥<~= item.pay_amount ~></div>
                <div class="weui-cell__ft">
                    <~ if(item.order_state==0){ ~>
                    <a href="javascript:;"
                       class="weui-btn weui-btn_mini weui-btn_plain-primary "
                       style="border: 1px solid #f15353;color: #f15353;">
                        去支付
                    </a>
                    <~ }  ~>
                    <~ if(item.order_state==3){ ~>
                    <a href="javascript:;"
                       class="weui-btn weui-btn_mini weui-btn_plain-primary "
                       style="border: 1px solid #f15353;color: #f15353;">
                        再次购买
                    </a>
                    <~ } ~>
                </div>
            </div>
        </div>
    </div>

    <~ }) ~>

    <~ } else { ~>

    <span></span>

    <~ } ~>
</script>

<% include ../footer.ejs %>
<script>
    //加载订单
    function loadOrder(status, pos) {
        ApiInvokeAdmin("order", "GetOrderList", {status: status, pos: pos, size: 10}, function (err, result) {
            if (err) {

            } else {
                var render_tpl_orderlistview = _.template($("#tpl_orderList").html().replace(/\~/igm, "%"));
                var render_tpl_orderlistviewHtml=render_tpl_orderlistview({orderlist: result});
                $("#allOrders").append(render_tpl_orderlistviewHtml);
            }
        });
    }

    $(function () {
        loadOrder('',0);
    });



</script>
</html>